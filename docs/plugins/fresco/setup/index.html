<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Flipper RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Flipper Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Flipper" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="https://fbflipper.com/js/code-blocks-buttons.js"></script>
<script src="https://fbflipper.com/js/google-analytics.js"></script><title data-react-helmet="true"></title><meta data-react-helmet="true" name="robots" content="noindex"><link rel="stylesheet" href="/assets/css/styles.5a89eae6.css">
<link rel="preload" href="/assets/js/runtime~main.32138094.js" as="script">
<link rel="preload" href="/assets/js/main.68cd5160.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div class="main-wrapper mdx-wrapper mdx-page embedded"><main><p>Currently, the <a href="/docs/features/plugins/fresco/">Image plugin</a> only supports <a href="https://frescolib.org/" target="_blank" rel="noopener noreferrer">Fresco</a> for Android as backend.</p><p>If you&#x27;d like to see support for other image loading libraries, please post your request in the <a href="https://fb.workplace.com/groups/flippersupport" target="_blank" rel="noopener noreferrer">Flipper Support</a> Workplace group.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="fresco-and-android">Fresco and Android<a aria-hidden="true" class="hash-link" href="#fresco-and-android" title="Direct link to heading">​</a></h2><p>The Fresco Images plugin is shipped as a separate Maven artifact:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  debugImplementation &#x27;com.facebook.flipper:flipper-fresco-plugin:0.30.1&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After including the plugin in your dependencies, you can add it to the client:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.facebook.flipper.plugins.fresco.FrescoFlipperPlugin;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">client.addPlugin(new FrescoFlipperPlugin());</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>FrescoFlipperPlugin</code> constructor offers a range of configuration options that can be useful if you have an advanced setup of Fresco in your application:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FrescoFlipperPlugin(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DebugImageTracker imageTracker,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      PlatformBitmapFactory bitmapFactory,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable FlipperObjectHelper flipperObjectHelper,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DebugMemoryManager memoryManager,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      FlipperPerfLogger perfLogger,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable FrescoFlipperDebugPrefHelper debugPrefHelper,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable CloseableReferenceLeakTracker closeableReferenceLeakTracker) { ... }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="leak-tracking">Leak Tracking<a aria-hidden="true" class="hash-link" href="#leak-tracking" title="Direct link to heading">​</a></h3><p>The Flipper plugin can help you track down <code>CloseableReferences</code> that have not had <code>close()</code> called on them. However, this can have a negative impact on the performance of your application.</p><p>To enable this functionality, you need to create a <code>CloseableReferenceLeakTracker</code> and set it in both your <code>ImagePipelineConfig</code> for Fresco and the <code>FrescoPluginPlugin</code> on creation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.facebook.imagepipeline.debug.FlipperCloseableReferenceLeakTracker;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FlipperCloseableReferenceLeakTracker leakTracker = new FlipperCloseableReferenceLeakTracker();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new ImagePipelineConfig.Builder()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .setCloseableReferenceLeakTracker(leakTracker)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">client.addPlugin(new FrescoFlipperPlugin(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new FlipperImageTracker(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Fresco.getImagePipelineFactory().getPlatformBitmapFactory(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new NoOpDebugMemoryManager(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new NoOpFlipperPerfLogger(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    leakTracker));</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="attribution">Attribution<a aria-hidden="true" class="hash-link" href="#attribution" title="Direct link to heading">​</a></h3><p>In order to annotate images with the context they are used in, you have to set a caller context when loading the image. This can be any object; for the simplest case, a String will suffice, as shown below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">String callerContext = &quot;my_feature&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For DraweeViews:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">draweeView.setImageURI(uri, callerContext);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For prefetching:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ImagePipeline imagePipeline = Fresco.getImagePipeline();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">imagePipeline.prefetchToDiskCache(imageRequest, callerContext);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For manually fetching an image:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dataSource = imagePipeline.fetchDecodedImage(imageRequest, callerContext);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If a caller context is supplied, the image will be properly attributed in the Flipper image plugin.</p></main></div></div>
<script src="/assets/js/runtime~main.32138094.js"></script>
<script src="/assets/js/main.68cd5160.js"></script>
</body>
</html>